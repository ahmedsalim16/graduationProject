<div class="d-flex">
  <!-- Sidebar -->
  <div id="sidebar" [ngClass]="{'hidden': !isSidebarOpen}">
    <div class="logo">
      <img [src]="schoolLogoUrl" alt="School Logo" class="school-logo animated-icon" [routerLink]="['/Dashboard']" loading="lazy">
      <h4 *ngIf="isSidebarOpen">{{schoolName}}</h4>
    </div>
  
    <div id="list">
      <!-- Dashboard -->
      <div class="dash">
        <i class="fa-solid fa-chart-line" style="color: #fff;"></i>
        <a routerLink="/Dashboard" class="list-group-item list-group-item-action" *ngIf="isSidebarOpen">Dashboard</a>
      </div>
  
      <!-- Student Dropdown -->
      <div class="dash" (click)="toggleDropdown('student')" style="cursor: pointer;">
        <i class="fa-solid fa-user" style="color: #ffffff;"></i>
        <span class="list-group-item list-group-item-action" *ngIf="isSidebarOpen">Student</span>
        <i class="fa-solid fa-chevron-right dropdown-arrow" [class.rotate]="isStudentOpen" *ngIf="isSidebarOpen"></i>
      </div>
      <div class="dropdown-content" [ngClass]="{'show': isStudentOpen}" *ngIf="isSidebarOpen">
        <a routerLink="/student-list" class="list-group-item active">Student List</a>
        <a routerLink="/absence-list" class="list-group-item">Absence List</a>
      </div>
  
      <!-- Admin Dropdown -->
      <div class="dash">
        <i class="fa-solid fa-user-shield" style="color: #ffffff;"></i>
        <a routerLink="/admin-list" class="list-group-item list-group-item-action" *ngIf="isSidebarOpen">Manager List</a>
      </div>
      <div class="dash">
        <i class="fa-solid fa-user-group" style="color: #ffffff;"></i>
        <a routerLink="/parent-list" class="list-group-item list-group-item-action" *ngIf="isSidebarOpen">Parent List</a>
      </div>
      <!-- Send Emails -->
      <div class="dash">
        <i class="fa-solid fa-paper-plane" style="color: #ffffff;"></i>
        <a routerLink="/Send-email" class="list-group-item list-group-item-action" *ngIf="isSidebarOpen">Send Report</a>
      </div>
  
      <!-- Logout -->
      <div class="dash" style="cursor: pointer;">
        <i class="fa-solid fa-right-from-bracket" style="color: #d21919;"></i>
        <a (click)="logout()" id="Logout" class="list-group-item list-group-item-action" *ngIf="isSidebarOpen">Logout</a>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div id="page-content-wrapper" class="flex-grow-1">
    <div class="header">
      <button title="toggle" id="toggle-sidebar" class="menu-btn" (click)="toggleSidebar()">
        <i class="fa-solid fa-bars" style="color: #ffffff;"></i>
      </button>
      <!-- Profile section -->
      <div class="profile-container">
        <img class="profile-img" src="../../assets/profile.png" alt="Profile" 
        (click)="navigateToAdminUpdate()" 
        [routerLink]="['/admin-update',adminId]" />
        <span class="profile-name">{{adminName}}</span>
      </div>
    </div>

    <div class="stud">
      <h2 id="head">Students</h2>
      
      <div class="card">
        <!-- PrimeNG Table -->
        <p-table 
          #dt 
          [value]="students" 
          [rows]="itemsPerPage" 
          [paginator]="true" 
          [rowsPerPageOptions]="itemsPerPageOptions"
          [globalFilterFields]="['fullname', 'city', 'street', 'parentemail']"
          [loading]="loading"
          dataKey="id"
          styleClass="p-datatable-gridlines p-datatable-sm"
          [tableStyle]="{ 'min-width': '75rem' }">
          
          <ng-template pTemplate="caption">
            <div class="flex justify-content-between">
              <div>
                <button pButton label="Clear" class="p-button-outlined" icon="pi pi-filter-slash" (click)="clear()" style="color: #00015d;"></button>
              </div>
              <div class="p-inputgroup">
                <span class="p-inputgroup-addon">
                  <i class="pi pi-search"></i>
                </span>
                <input pInputText type="text" (input)="applyFilterGlobal($event, 'contains')" placeholder="Search keyword" />
              </div>
              <div>
                <button pButton label="Add Student" icon="pi pi-plus" routerLink="/student"> </button>
                <button pButton label="Download CSV" icon="pi pi-download" (click)="downloadCsvFile()" class="p-button-secondary ml-2"> </button>
              </div>
            </div>
          </ng-template>
          
          <ng-template pTemplate="header">
            <tr>
              <th>#</th>
              <th pSortableColumn="id">ID <p-sortIcon field="id"></p-sortIcon></th>
              <th pSortableColumn="fullname">Full Name <p-sortIcon field="fullname"></p-sortIcon></th>
              <th pSortableColumn="gender">Gender <p-sortIcon field="gender"></p-sortIcon></th>
              <th pSortableColumn="grade">Grade <p-sortIcon field="grade"></p-sortIcon></th>
              <th pSortableColumn="city">City <p-sortIcon field="city"></p-sortIcon></th>
              <th pSortableColumn="street">Street <p-sortIcon field="street"></p-sortIcon></th>
              <th pSortableColumn="birthdate">Birth Date <p-sortIcon field="birthdate"></p-sortIcon></th>
              <th pSortableColumn="rfidtag_id">RFID Tag ID <p-sortIcon field="rfidtag_id"></p-sortIcon></th>
              <th pSortableColumn="createdon">Created on <p-sortIcon field="createdon"></p-sortIcon></th>
              <th pSortableColumn="parentemail">Parent Email <p-sortIcon field="parentemail"></p-sortIcon></th>
              <th>Actions</th>
            </tr>
            <tr>
              <th></th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'id', 'contains')" placeholder="Search ID" class="w-full" />
              </th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'fullname', 'contains')" placeholder="Search name" class="w-full" />
              </th>
              <th>
                <p-dropdown [options]="genderOptions" (onChange)="onGenderChange($event)" [showClear]="true" placeholder="Select Gender"></p-dropdown>
              </th>
              <th>
                <p-dropdown [options]="gradeOptions" (onChange)="onGradeChange($event)" [showClear]="true" placeholder="Select Grade"></p-dropdown>
              </th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'city', 'contains')" placeholder="Search city" class="w-full" />
              </th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'street', 'contains')" placeholder="Search street" class="w-full" />
              </th>
              <th></th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'rfidtag_id', 'contains')" placeholder="Search RFID" class="w-full" />
              </th>
              <th></th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'parentemail', 'contains')" placeholder="Search email" class="w-full" />
              </th>
              <th></th>
            </tr>
          </ng-template>
          
          <ng-template pTemplate="body" let-student let-i="rowIndex">
            <tr>
              <td>{{i + 1}}</td>
              <td>{{student.id}}</td>
              <td>{{student.fullname | titlecase}}</td>
              <td>
                <p-tag [value]="getGenderText(student.gender)" [severity]="getGenderSeverity(student.gender)"></p-tag>
              </td>
              <td>{{student.grade}}</td>
              <td>{{student.city}}</td>
              <td>{{student.street}}</td>
              <td>{{student.birthdate ? (student.birthdate | date: 'yyyy-MM-dd') : 'N/A'}}</td>
              <td>{{student.rfidtag_id}}</td>
              <td>{{student.createdon ? (student.createdon | date: 'yyyy-MM-dd') : 'N/A'}}</td>
              <td>{{student.parentemail}}</td>
              <td>
                <div class="flex gap-2">
                  <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-success p-button-sm" 
                    [routerLink]="['/update', student.id]"
                    title="Edit"></button>
                  <button pButton icon="pi pi-trash" class="p-button-rounded p-button-danger p-button-sm"
                    (click)="delete(student.id)"
                    title="Delete"></button>
                </div>
              </td>
            </tr>
          </ng-template>
          
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="12" class="text-center">No students found.</td>
            </tr>
          </ng-template>
          
          <ng-template pTemplate="summary">
            <div class="flex justify-content-between">
              Total Records: {{students ? students.length : 0}}
            </div>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
</div>