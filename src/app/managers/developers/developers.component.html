<div class="d-flex">
  <!-- Sidebar -->
  <div id="sidebar" [ngClass]="{'hidden': !isSidebarOpen}">
    <div class="logo">
      <i class="fa-solid fa-graduation-cap animated-icon" style="color: #fff; cursor: pointer" [routerLink]="['/dashboard']"></i>
      <h4 *ngIf="isSidebarOpen">SMART</h4>
      <h5 *ngIf="isSidebarOpen">TRACK</h5>
    </div>
  
    <div id="list">
      <div class="dash">
        <i class="fa-solid fa-chart-line" style="color: #fff;"></i>
        <a routerLink="/dashboard" class="list-group-item list-group-item-action active" *ngIf="isSidebarOpen">Dashboard</a>
      </div>
      
      <!-- School Dropdown -->
      <div class="dash" (click)="toggleDropdown('school')" style="cursor: pointer;">
        <i class="fa-solid fa-school" style="color: #ffffff;"></i>
        <span class="list-group-item list-group-item-action" *ngIf="isSidebarOpen">Schools</span>
        <i class="fa-solid fa-chevron-right dropdown-arrow" [class.rotate]="isSchoolOpen" *ngIf="isSidebarOpen"></i>
      </div>
      <div class="dropdown-content" [ngClass]="{'show': isSchoolOpen}" *ngIf="isSidebarOpen">
        <a routerLink="/school-list" class="list-group-item">Schools</a>
        <a routerLink="/add-owner" class="list-group-item">Add Managers</a>
      </div>
  
      <!-- Developers -->
      <div class="dash">
        <i class="fa-solid fa-user-shield" style="color: #ffffff;"></i>
        <a routerLink="/developers" class="list-group-item active" style="opacity: 1;" *ngIf="isSidebarOpen">Developers</a>
      </div>
    
      <!-- Logout -->
      <div class="dash" style="cursor: pointer;">
        <i class="fa-solid fa-right-from-bracket" style="color: #d21919;"></i>
        <a (click)="logout()" id="Logout" class="list-group-item list-group-item-action" *ngIf="isSidebarOpen">Logout</a>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div id="page-content-wrapper" class="flex-grow-1">
    <div class="header">
      <button title="toggle" id="toggle-sidebar" class="menu-btn" (click)="toggleSidebar()">
        <i class="fa-solid fa-bars" style="color: #ffffff;"></i>
      </button>
      <div class="profile-container">
        <img class="profile-img" src="../../assets/profile.png" alt="Profile" 
          (click)="navigateToAdminUpdate()" 
          [routerLink]="['/admin-update',adminId]" />
        <span class="profile-name">{{adminName}}</span>
      </div>
    </div>

    <div class="stud">
      <h2 id="head">Developers</h2>
      
      <div class="card">
        <!-- PrimeNG Table -->
        <p-table 
          #dt 
          [value]="admins" 
          [rows]="itemsPerPage" 
          [paginator]="true" 
          [rowsPerPageOptions]="itemsPerPageOptions"
          [globalFilterFields]="['userName', 'email', 'firstName', 'lastName', 'phoneNumber', 'gender', 'role']"
          [loading]="loading"
          dataKey="id"
          styleClass="p-datatable-gridlines p-datatable-sm"
          [tableStyle]="{ 'min-width': '75rem' }">
          
          <ng-template pTemplate="caption">
            <div class="flex justify-content-between">
              <div>
                <button pButton label="Clear" class="p-button-outlined" icon="pi pi-filter-slash" (click)="clear()" style="color: #00015d;"></button>
              </div>
              <div class="p-inputgroup">
                <span class="p-inputgroup-addon">
                  <i class="pi pi-search"></i>
                </span>
                <input pInputText type="text" (input)="applyFilterGlobal($event, 'contains')" placeholder="Search keyword" />
              </div>
              <div>
                <button pButton label="Add Developer" icon="pi pi-plus" routerLink="/add-developer"></button>
                <button pButton label="Download CSV" icon="pi pi-download" (click)="downloadCsvFile()" class="p-button-secondary ml-2"></button>
              </div>
            </div>
          </ng-template>
          
          <ng-template pTemplate="header">
            <tr>
              <th>#</th>
              <th pSortableColumn="id">ID <p-sortIcon field="id"></p-sortIcon></th>
              <th pSortableColumn="userName">Username <p-sortIcon field="userName"></p-sortIcon></th>
              <th pSortableColumn="email">Email <p-sortIcon field="email"></p-sortIcon></th>
              <th pSortableColumn="firstName">First Name <p-sortIcon field="firstName"></p-sortIcon></th>
              <th pSortableColumn="lastName">Last Name <p-sortIcon field="lastName"></p-sortIcon></th>
              <th pSortableColumn="phoneNumber">Phone <p-sortIcon field="phoneNumber"></p-sortIcon></th>
              <th pSortableColumn="address">Address <p-sortIcon field="address"></p-sortIcon></th>
              <th pSortableColumn="gender">Gender <p-sortIcon field="gender"></p-sortIcon></th>
              <th pSortableColumn="role">Role <p-sortIcon field="role"></p-sortIcon></th>
              <th pSortableColumn="createdOn">Created On <p-sortIcon field="createdOn"></p-sortIcon></th>
              <th pSortableColumn="owner">Is Owner <p-sortIcon field="owner"></p-sortIcon></th>
              <th>Actions</th>
            </tr>
            <tr>
              <th></th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'id', 'contains')" placeholder="Search ID" class="w-full" />
              </th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'userName', 'contains')" placeholder="Search username" class="w-full" />
              </th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'email', 'contains')" placeholder="Search email" class="w-full" />
              </th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'firstName', 'contains')" placeholder="Search first name" class="w-full" />
              </th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'lastName', 'contains')" placeholder="Search last name" class="w-full" />
              </th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'phoneNumber', 'contains')" placeholder="Search phone" class="w-full" />
              </th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'address', 'contains')" placeholder="Search address" class="w-full" />
              </th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'gender', 'contains')" placeholder="Search gender" class="w-full" />
              </th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
            </tr>
          </ng-template>
          
          <ng-template pTemplate="body" let-admin let-i="rowIndex">
            <tr>
              <td>{{i + 1}}</td>
              <td>{{admin.id}}</td>
              <td>{{admin.userName}}</td>
              <td>{{admin.email}}</td>
              <td>{{admin.firstName}}</td>
              <td>{{admin.lastName}}</td>
              <td>{{admin.phoneNumber}}</td>
              <td>{{admin.address}}</td>
              <td>
                <p-tag [value]="getGenderText(admin.gender)" 
                       [severity]="getGenderSeverity(admin.gender)"></p-tag>
              </td>
              <td>
                <p-tag [value]="admin.role" 
                       [severity]="getRoleSeverity(admin.role)"></p-tag>
              </td>
              <td>{{admin.createdOn ? (admin.createdOn | date: 'yyyy-MM-dd') : 'N/A'}}</td>
              <td>{{admin.owner}}</td>
              <td>
                <div class="flex gap-2">
                  <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-success p-button-sm" 
                    *ngIf="(admin.role==='Admin') && (admin.id===MId)"
                    [routerLink]="['/admin-update', admin.id]"
                    title="Edit"></button>
                  <button pButton icon="pi pi-trash" class="p-button-rounded p-button-danger p-button-sm"
                    *ngIf="(admin.role==='Admin') && (IsOwner()===true)" 
                    (click)="delete(admin.id)"
                    title="Delete"></button>
                </div>
              </td>
            </tr>
          </ng-template>
          
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="13" class="text-center">No developers found.</td>
            </tr>
          </ng-template>
          
          <ng-template pTemplate="summary">
            <div class="flex justify-content-between">
              Total Records: {{admins ? admins.length : 0}}
            </div>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
</div>