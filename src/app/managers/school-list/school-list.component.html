<div class="d-flex">
  <!-- Sidebar -->
  <div id="sidebar" [ngClass]="{'hidden': !isSidebarOpen}">
    <div class="logo">
      <i class="fa-solid fa-graduation-cap animated-icon" style="color: #fff; cursor: pointer" [routerLink]="['/dashboard']"></i>
      <h4 *ngIf="isSidebarOpen">SMART</h4>
      <h5 *ngIf="isSidebarOpen">TRACK</h5>
    </div>
  
    <div id="list">
      <div class="dash">
        <i class="fa-solid fa-chart-line" style="color: #fff;"></i>
        <a routerLink="/dashboard" class="list-group-item list-group-item-action active" *ngIf="isSidebarOpen">Dashboard</a>
      </div>
      
      <!-- School Dropdown -->
      <div class="dash" (click)="toggleDropdown('school')" style="cursor: pointer;">
        <i class="fa-solid fa-school" style="color: #ffffff;"></i>
        <span class="list-group-item list-group-item-action" *ngIf="isSidebarOpen">Schools</span>
        <i class="fa-solid fa-chevron-right dropdown-arrow" [class.rotate]="isSchoolOpen" *ngIf="isSidebarOpen"></i>
      </div>
      <div class="dropdown-content" [ngClass]="{'show': isSchoolOpen}" *ngIf="isSidebarOpen">
        <a routerLink="/school-list" class="list-group-item active" style="opacity: 1;">Schools</a>
        <a routerLink="/add-owner" class="list-group-item">Add Managers</a>
      </div>
  
      <div class="dash">
        <i class="fa-solid fa-user-shield" style="color: #ffffff;"></i>
        <a routerLink="/developers" class="list-group-item active" style="opacity: 1;" *ngIf="isSidebarOpen">Developers</a>
      </div>
    
      <!-- Logout -->
      <div class="dash" style="cursor: pointer;">
        <i class="fa-solid fa-right-from-bracket" style="color: #d21919;"></i>
        <a (click)="logout()" id="Logout" class="list-group-item list-group-item-action" *ngIf="isSidebarOpen">Logout</a>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div id="page-content-wrapper" class="flex-grow-1">
    <div class="header">
      <button title="toggle" id="toggle-sidebar" class="menu-btn" (click)="toggleSidebar()">
        <i class="fa-solid fa-bars" style="color: #ffffff;"></i>
      </button>
      <div class="profile-container">
        <img class="profile-img" src="../../assets/profile.png" alt="Profile" 
          (click)="navigateToAdminUpdate()" 
          [routerLink]="['/admin-update',adminId]" />
        <span class="profile-name">{{adminName}}</span>
      </div>
    </div>

    <div class="stud">
      <h2 id="head">Schools</h2>
      
      <div class="card">
        <!-- PrimeNG Table -->
        <p-table 
          #dt 
          [value]="schools" 
          [rows]="itemsPerPage" 
          [paginator]="true" 
          [rowsPerPageOptions]="itemsPerPageOptions"
          [globalFilterFields]="['name', 'country', 'phonenumber', 'email']"
          [loading]="loading"
          dataKey="schooltenantid"
          styleClass="p-datatable-gridlines p-datatable-sm"
          [tableStyle]="{ 'min-width': '75rem' }">
          
          <ng-template pTemplate="caption">
            <div class="flex justify-content-between">
              <div>
                <button pButton label="Clear" class="p-button-outlined" icon="pi pi-filter-slash" (click)="clear()" style="color: #00015d;"></button>
              </div>
              <div class="p-inputgroup">
                <span class="p-inputgroup-addon">
                  <i class="pi pi-search"></i>
                </span>
                <input pInputText type="text" (input)="applyFilterGlobal($event, 'contains')" placeholder="Search keyword" />
              </div>
              <div>
                <button pButton label="Add School" icon="pi pi-plus" routerLink="/add-school"></button>
                <button pButton label="Download CSV" icon="pi pi-download" (click)="downloadCsvFile()" class="p-button-secondary ml-2"></button>
              </div>
            </div>
          </ng-template>
          
          <ng-template pTemplate="header">
            <tr>
              <th>#</th>
              <th pSortableColumn="schooltenantid">ID <p-sortIcon field="schooltenantid"></p-sortIcon></th>
              <th pSortableColumn="name">Name <p-sortIcon field="name"></p-sortIcon></th>
              <th pSortableColumn="description">Description <p-sortIcon field="description"></p-sortIcon></th>
              <th pSortableColumn="address">Address <p-sortIcon field="address"></p-sortIcon></th>
              <th pSortableColumn="country">Country <p-sortIcon field="country"></p-sortIcon></th>
              <th pSortableColumn="phonenumber">Phone <p-sortIcon field="phonenumber"></p-sortIcon></th>
              <th pSortableColumn="email">Email <p-sortIcon field="email"></p-sortIcon></th>
              <th>Logo</th>
              <th pSortableColumn="createdon">Created On <p-sortIcon field="createdon"></p-sortIcon></th>
              <th>Actions</th>
            </tr>
            <tr>
              <th></th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'schooltenantid', 'contains')" placeholder="Search ID" class="w-full" />
              </th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'name', 'contains')" placeholder="Search name" class="w-full" />
              </th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'description', 'contains')" placeholder="Search description" class="w-full" />
              </th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'address', 'contains')" placeholder="Search address" class="w-full" />
              </th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'country', 'contains')" placeholder="Search country" class="w-full" />
              </th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'phonenumber', 'contains')" placeholder="Search phone" class="w-full" />
              </th>
              <th>
                <input pInputText type="text" (input)="onFilterChange($event, 'email', 'contains')" placeholder="Search email" class="w-full" />
              </th>
              <th></th>
              <th></th>
              <th></th>
            </tr>
          </ng-template>
          
          <ng-template pTemplate="body" let-school let-i="rowIndex">
            <tr>
              <td>{{i + 1}}</td>
              <td>{{school.schooltenantid}}</td>
              <td>{{school.name}}</td>
              <td>{{school.description}}</td>
              <td>{{school.address}}</td>
              <td>{{school.country}}</td>
              <td>{{school.phonenumber}}</td>
              <td>{{school.email}}</td>
              <td>
                <img [src]="getImageUrl(school.schoollogo)" alt="School Logo" class="school-logo" loading="lazy">
              </td>
              <td>{{school.createdon ? (school.createdon | date: 'yyyy-MM-dd') : 'N/A'}}</td>
              <td>
                <div class="flex gap-2">
                  <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-success p-button-sm" 
                    [routerLink]="['/update-school', school.schooltenantid]"
                    title="Edit"></button>
                  <button pButton icon="pi pi-trash" class="p-button-rounded p-button-danger p-button-sm"
                    (click)="delete(school.schooltenantid)"
                    title="Delete"></button>
                </div>
              </td>
            </tr>
          </ng-template>
          
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="11" class="text-center">No schools found.</td>
            </tr>
          </ng-template>
          
          <ng-template pTemplate="summary">
            <div class="flex justify-content-between">
              Total Records: {{schools ? schools.length : 0}}
            </div>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
</div>